# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è HTTPS –ø–æ–¥–¥–µ—Ä–∂–∫–∏

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

–í —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∑–∞–¥–∞–Ω–∏–µ–º –¥–ª—è —Ç—Ä–µ–∫–∞ ¬´–°–µ—Ä–≤–∏—Å —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è URL¬ª –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–∫–ª—é—á–µ–Ω–∏—è HTTPS –≤ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–µ:

- ‚úÖ **–§–ª–∞–≥ -s**: –ü—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ —Ñ–ª–∞–≥–∞ `-s` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è HTTPS —Å–µ—Ä–≤–µ—Ä
- ‚úÖ **–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è ENABLE_HTTPS**: –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `ENABLE_HTTPS` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è HTTPS —Å–µ—Ä–≤–µ—Ä  
- ‚úÖ **ListenAndServeTLS**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ `http.ListenAndServeTLS` –¥–ª—è HTTPS —Å–µ—Ä–≤–µ—Ä–∞

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. Config (internal/config/config.go)

**–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—è:**
```go
// HTTPS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
EnableHTTPS string `env:"ENABLE_HTTPS"` // –í–∫–ª—é—á–∏—Ç—å HTTPS —Å–µ—Ä–≤–µ—Ä
TLSCertFile string `env:"TLS_CERT_FILE"` // –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ TLS
TLSKeyFile  string `env:"TLS_KEY_FILE"`  // –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ TLS
```

**–ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
```go
// IsHTTPSEnabled –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –≤–∫–ª—é—á–µ–Ω –ª–∏ HTTPS —Ä–µ–∂–∏–º
func (c *Config) IsHTTPSEnabled() bool
```

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–ª–∞–≥–∏:**
- `-s string` - –≤–∫–ª—é—á–∏—Ç—å HTTPS —Å–µ—Ä–≤–µ—Ä (–∏–∑–º–µ–Ω–µ–Ω —Å —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞)
- `-secret-key string` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –∫—É–∫ (–Ω–æ–≤—ã–π —Ñ–ª–∞–≥)
- `-tls-cert string` - –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞  
- `-tls-key string` - –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É TLS –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞

### 2. App (internal/app/app.go)

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ Run():**
```go
func (a *App) Run() error {
    // ...
    if a.config.IsHTTPSEnabled() {
        a.logger.Info("Starting HTTPS server", ...)
        return server.ListenAndServeTLS(a.config.TLSCertFile, a.config.TLSKeyFile)
    }
    
    a.logger.Info("Starting HTTP server", ...)
    return server.ListenAndServe()
}
```

### 3. Main files (cmd/shortener/main.go, cmd/api/main.go)

**–î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞:**
```go
if cfg.IsHTTPSEnabled() {
    // HTTPS –∑–∞–ø—É—Å–∫
    server.ListenAndServeTLS(cfg.TLSCertFile, cfg.TLSKeyFile)
} else {
    // HTTP –∑–∞–ø—É—Å–∫
    server.ListenAndServe()
}
```

## üõ† –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

**Linux/macOS:**
```bash
./generate_certs.sh
```

**Windows:**
```powershell
.\generate_certs.ps1
```

### 2. –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

- `TLSCertFile`: `"server.crt"`
- `TLSKeyFile`: `"server.key"`
- `EnableHTTPS`: `""` (–æ—Ç–∫–ª—é—á–µ–Ω)

## üìã –°–ø–æ—Å–æ–±—ã –∑–∞–ø—É—Å–∫–∞

### 1. –ß–µ—Ä–µ–∑ —Ñ–ª–∞–≥ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

```bash
# –í–∫–ª—é—á–∏—Ç—å HTTPS
go run ./cmd/shortener -s true

# –° –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
go run ./cmd/shortener -s true -tls-cert my.crt -tls-key my.key
```

### 2. –ß–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –í–∫–ª—é—á–∏—Ç—å HTTPS
export ENABLE_HTTPS=true
go run ./cmd/shortener

# –° –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
export ENABLE_HTTPS=true
export TLS_CERT_FILE=my.crt
export TLS_KEY_FILE=my.key
go run ./cmd/shortener
```

### 3. –°–º–µ—à–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º

```bash
# –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è + —Ñ–ª–∞–≥–∏
export ENABLE_HTTPS=true
go run ./cmd/shortener -tls-cert custom.crt -tls-key custom.key
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. Unit —Ç–µ—Å—Ç—ã

```bash
go test ./internal/config -v -run="TestHTTPS"
```

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ HTTPS —Å–µ—Ä–≤–µ—Ä–∞
export ENABLE_HTTPS=true
go run ./cmd/shortener

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å curl
curl -k -X POST https://localhost:8080/api/shorten \
  -H "Content-Type: application/json" \
  -d '{"url": "https://example.com"}'
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
- –ë—Ä–∞—É–∑–µ—Ä—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ü–æ–¥—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –î–ª—è production
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –æ—Ç –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ CA
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ DNS –∑–∞–ø–∏—Å–∏
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

## üìÅ –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
trunc_url/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îú‚îÄ‚îÄ shortener/main.go    # HTTPS –ø–æ–¥–¥–µ—Ä–∂–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ api/main.go          # HTTPS –ø–æ–¥–¥–µ—Ä–∂–∫–∞
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.go        # HTTPS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config_https_test.go # HTTPS —Ç–µ—Å—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ app/app.go           # HTTPS –ª–æ–≥–∏–∫–∞ –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ generate_certs.sh        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (Linux/macOS)
‚îú‚îÄ‚îÄ generate_certs.ps1       # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (Windows)
‚îú‚îÄ‚îÄ README_HTTPS.md          # –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ .gitignore               # –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∑–∞–¥–∞–Ω–∏—é

1. ‚úÖ **–§–ª–∞–≥ -s**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è HTTPS
2. ‚úÖ **–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è ENABLE_HTTPS**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è HTTPS
3. ‚úÖ **http.ListenAndServeTLS**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è HTTPS —Å–µ—Ä–≤–µ—Ä–∞
4. ‚úÖ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: HTTP —Ä–µ–∂–∏–º –æ—Å—Ç–∞–ª—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
5. ‚úÖ **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ü—É—Ç–∏ –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ–ª–∞–≥–∏/–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
6. ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
7. ‚úÖ **–¢–µ—Å—Ç—ã**: Unit —Ç–µ—Å—Ç—ã –¥–ª—è HTTPS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –∑–∞–¥–∞–Ω–∏—è! üéâ 